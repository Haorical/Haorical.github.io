<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>haorical&#39;s blog</title>
  
  
  <link href="https://haorical.github.io/atom.xml" rel="self"/>
  
  <link href="https://haorical.github.io/"/>
  <updated>2021-02-02T14:31:28.427Z</updated>
  <id>https://haorical.github.io/</id>
  
  <author>
    <name>haorical</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>爬取&quot;冰冰vlog.001&quot;评论&amp;&amp;做词云</title>
    <link href="https://haorical.github.io/2021/02/02/%E7%88%AC%E5%8F%96-%E5%86%B0%E5%86%B0vlog-001-%E8%AF%84%E8%AE%BA-%E5%81%9A%E8%AF%8D%E4%BA%91-1/"/>
    <id>https://haorical.github.io/2021/02/02/%E7%88%AC%E5%8F%96-%E5%86%B0%E5%86%B0vlog-001-%E8%AF%84%E8%AE%BA-%E5%81%9A%E8%AF%8D%E4%BA%91-1/</id>
    <published>2021-02-02T14:29:00.000Z</published>
    <updated>2021-02-02T14:31:28.427Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>python小白，纯属来玩的（狗头）</p></blockquote><h1 id="库准备（推荐清华镜像安装）"><a href="#库准备（推荐清华镜像安装）" class="headerlink" title="库准备（推荐清华镜像安装）"></a>库准备（推荐清华镜像安装）</h1><ol><li>requests</li><li>bs4</li><li>jieba</li><li>wordcloud</li><li>imageio</li><li>matplotlib</li></ol><h1 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h1><h2 id="爬取评论"><a href="#爬取评论" class="headerlink" title="爬取评论"></a>爬取评论</h2><blockquote><p>代码直接贴上了，自行研究</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span>(<span class="params">url</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r = requests.get(url, timeout=<span class="number">30</span>,headers=headers)</span><br><span class="line">    r.raise_for_status()</span><br><span class="line">    r.endcodding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> r.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span>(<span class="params">url</span>):</span></span><br><span class="line">    comments = []</span><br><span class="line">    html = get_html(url)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s=json.loads(html)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&quot;jsonload error&quot;</span>)   </span><br><span class="line">    num=<span class="built_in">len</span>(s[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;replies&#x27;</span>]) </span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;num:</span><br><span class="line">        comment=s[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;replies&#x27;</span>][i]</span><br><span class="line">        InfoDict=&#123;&#125;</span><br><span class="line">        InfoDict[<span class="string">&#x27;Uname&#x27;</span>]=comment[<span class="string">&#x27;member&#x27;</span>][<span class="string">&#x27;uname&#x27;</span>]</span><br><span class="line">        InfoDict[<span class="string">&#x27;Like&#x27;</span>]=comment[<span class="string">&#x27;like&#x27;</span>] </span><br><span class="line">        InfoDict[<span class="string">&#x27;Content&#x27;</span>]=comment[<span class="string">&#x27;content&#x27;</span>][<span class="string">&#x27;message&#x27;</span>] </span><br><span class="line">        InfoDict[<span class="string">&#x27;Time&#x27;</span>]=time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>,time.localtime(comment[<span class="string">&#x27;ctime&#x27;</span>])) </span><br><span class="line">        comments.append(InfoDict)</span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> comments</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Out2File</span>(<span class="params"><span class="built_in">dict</span></span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;BiliBiliComments.txt&#x27;</span>, <span class="string">&#x27;a+&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> comment <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">            i=i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                f.write(<span class="string">&#x27;姓名：&#123;&#125;\t  点赞数：&#123;&#125;\t \n 评论内容：&#123;&#125;\t  评论时间：&#123;&#125;\t \n &#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                    comment[<span class="string">&#x27;Uname&#x27;</span>], comment[<span class="string">&#x27;Like&#x27;</span>], comment[<span class="string">&#x27;Content&#x27;</span>], comment[<span class="string">&#x27;Time&#x27;</span>]))</span><br><span class="line">                f.write(<span class="string">&quot;-----------------\n&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                print(<span class="string">&quot;out2File error&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;当前页面保存完成&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    e=<span class="number">0</span></span><br><span class="line">    page=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> e == <span class="number">0</span> :</span><br><span class="line">        url = <span class="string">&quot;https://api.bilibili.com/x/v2/reply?pn=&quot;</span>+ <span class="built_in">str</span>(page)+<span class="string">&quot;&amp;type=1&amp;oid=800760067&amp;sort=2&quot;</span> </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print()</span><br><span class="line">            content=get_content(url)</span><br><span class="line">            print(<span class="string">&quot;page:&quot;</span>,page)</span><br><span class="line">            Out2File(content)</span><br><span class="line">            page=page+<span class="number">1</span></span><br><span class="line">            <span class="comment"># 为了降低被封ip的风险，每爬20页便歇5秒。</span></span><br><span class="line">            <span class="keyword">if</span> page%<span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">                time.sleep(<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            e=<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="生成词云"><a href="#生成词云" class="headerlink" title="生成词云"></a>生成词云</h2><p>这个需要先有个图片，随便网上找，然后和py放在一个文件夹下。</p><blockquote><p>代码附上（文件，图片改成自己的）</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> jieba.analyse</span><br><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud,ImageColorGenerator</span><br><span class="line"><span class="keyword">from</span> imageio <span class="keyword">import</span> imread</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">wc</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,txt_file,img_file,font_file</span>):</span></span><br><span class="line">    self.f = <span class="built_in">open</span>(txt_file,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    self.txt = self.f.read()  </span><br><span class="line">    self.f.close()</span><br><span class="line">    self.tags = jieba.analyse.extract_tags(self.txt,topK=<span class="number">100</span>)</span><br><span class="line">    self.text = <span class="string">&#x27; &#x27;</span>.join(self.tags)</span><br><span class="line">    self.img = imread(img_file)</span><br><span class="line">    self.wc = WordCloud(font_path=font_file,background_color=<span class="string">&#x27;white&#x27;</span>,max_words=<span class="number">100</span>,mask=self.img,max_font_size=<span class="number">80</span>)</span><br><span class="line">    self.word_cloud = self.wc.generate(self.text)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show_wc</span>(<span class="params">self</span>):</span></span><br><span class="line">    plt.imshow(self.word_cloud)</span><br><span class="line">    plt.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  mywc = wc(<span class="string">&#x27;BiliBiliComments.txt&#x27;</span>,<span class="string">&#x27;u=2959490536,2877096479&amp;fm=26&amp;gp=0.jpg&#x27;</span>,<span class="string">&#x27;simsun.ttc&#x27;</span>)</span><br><span class="line">  mywc.show_wc()</span><br></pre></td></tr></table></figure><blockquote><p><strong>还是那句话，冰冰真可爱（狗头）</strong></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;python小白，纯属来玩的（狗头）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;库准备（推荐清华镜像安装）&quot;&gt;&lt;a href=&quot;#库准备（推荐清华镜像安装）&quot; class=&quot;headerlink&quot; title=&quot;库准备（推荐清华镜像安装）</summary>
      
    
    
    
    <category term="play" scheme="https://haorical.github.io/categories/play/"/>
    
    
    <category term="python" scheme="https://haorical.github.io/tags/python/"/>
    
    <category term="爬虫" scheme="https://haorical.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://haorical.github.io/2021/02/01/hello-world/"/>
    <id>https://haorical.github.io/2021/02/01/hello-world/</id>
    <published>2021-02-01T06:41:27.092Z</published>
    <updated>2021-02-01T06:41:27.092Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
